# 読書管理 Web アプリ仕様書

Version: 0.1.0 (2025-12-05)

※この文書は初期設計の指針です。実装の進行に合わせて見直します。

---

## 1. コンセプト・前提

* 個人用の読書管理＋ランキング Web アプリ
* 利用者は実質 1 アカウントのみ（自分用）
* Rust 製 / 自前ホスト前提
* 一部ページは公開して「個人本棚サイト」として見せる

目的：

* ISBN から書誌情報＋書影を取得して、本を楽に登録する
* 2 択「どっちが好き？」でシリーズのレーティングを決め、個人的ランキングを形成する
* タグやシーズン単位で好みを振り返れる

---

## 2. 技術スタック

* バックエンド: Rust + axum
* テンプレート: askama（SSR）
* DB: SQLite + SQLx
* 認証方式: Cookie セッション

  * パスワードハッシュ: argon2
* デプロイ: 単一バイナリ + SQLite ファイル

---

## 3. 機能仕様

### 3.1 認証

* メール + パスワードでログイン
* ログイン必須の操作：

  * 本・シリーズ・タグの登録/編集/削除
  * 読了記録の管理
  * レーティング入力（2択）
  * レビュー作成/編集
* ログイン不要で閲覧可：

  * 本棚ページ
  * ランキングページ
  * 各本の詳細ページ

---

### 3.2 書誌情報取得

* ISBN 入力で外部 API より書誌情報取得
* 参照優先度：NDL → OpenBD
* 取得項目：

  * タイトル
  * 著者
  * 出版社
  * 出版年
  * 書影 URL
* 書影が取得できない場合：プレースホルダー画像表示

---

### 3.3 本・シリーズ・タグ管理

| 項目           | 概要                |
| ------------ | ----------------- |
| 本（Book）      | シリーズに紐づく or 単独も可  |
| シリーズ（Series） | レーティング対象。1:多で本を持つ |
| タグ（Tag）      | 自由タグ。多:多で本と紐づく    |

* タグ名は編集可能（内部 ID は固定）
* タグ検索で選択補助

---

### 3.4 読了記録（Ranking の基準）

* 読了日を `reading_records` に保存
* 再読フラグ有り (`is_reread`)

  * ランキング対象は再読を除外
* シーズン判定：

  * 四半期 / 年 / 総合を `finished_date` から計算

---

### 3.5 レーティングとランキング

* 対象：シリーズ単位
* レーティング方式：初期は Elo

  * 将来方式変更に備えて抽象化
* 入力：2択比較「どっちが好き？」
* 試合履歴を全保存して再計算可能 (`matches`)
* マッチング方針：

  * 直近対戦していない
  * レート差が小さい
* 公開範囲：

  * レート値は非公開
  * 並び順のみ公開

---

### 3.6 レビュー（感想）

* テキスト形式
* 公開/非公開切替可
* 1冊に複数レビュー可（追記方式）

---

### 3.7 検索・一覧・表示機能

* 検索対象：タイトル / 著者 / タグ
* 一致方法：完全一致 / 部分一致
* ソート：

  * 読了順 / レート順
* 絞り込み：

  * タグ別 / 著者別 / シーズン別
* レスポンシブ対応
* SEO不要だが OGP 対応

---

## 4. URL/画面一覧

### 公開ページ

| URL             | 内容                |
| --------------- | ----------------- |
| `/`             | トップ               |
| `/books`        | 本一覧（検索・ソート可）      |
| `/books/:id`    | 本の詳細（レビュー公開分）     |
| `/series/:slug` | シリーズページ           |
| `/tags/:slug`   | タグページ             |
| `/ranking`      | ランキング（期間・タグ等絞り込み） |

### 管理ページ（ログイン必須）

* `/login` / `/logout`
* `/admin/books/*`
* `/admin/series/*`
* `/admin/tags/*`
* `/admin/reading-records/*`
* `/admin/reviews/*`
* `/admin/match`
  → 2択レーティング
* `/admin/export`（GET）
* `/admin/import`（POST）

---

## 5. データモデル概要

主要テーブルのみ記載（詳細は別紙スキーマに展開）

| テーブル            | 目的                 |
| --------------- | ------------------ |
| users           | ログイン情報             |
| books           | 本情報                |
| series          | シリーズ               |
| tags            | タグ                 |
| book_tags       | 本↔タグのリレーション(N:N)   |
| reading_records | 読了履歴               |
| reviews         | 感想                 |
| rating_subjects | レート対象の抽象化          |
| ratings         | レーティング値（system別保持） |
| matches         | 比較履歴（再計算用）         |

---

## 6. バックアップ・移行仕様

* SQLite `.db` ファイルそのものをコピーしてバックアップ可能
* JSON エクスポート / インポート機能を提供
* JSON に全テーブル情報をまとめる
* JSON＋空 DB で全状態を復元できる

---

## 7. 非機能要件

* 想定データ規模：数百〜数万冊
* シングルユーザー前提で SQLite で性能十分
* 将来的に PostgreSQL などへ移行可能（SQLx採用のため）

---

## 8. 更新履歴

| Version | Date       | Changes |
| ------- | ---------- | ------- |
| 0.1.0   | 2025-12-05 | 初版作成    |

---

